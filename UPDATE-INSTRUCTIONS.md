# Update Existing Project Instructions

**Purpose:** Safely update project instructions when new-project-ai-prompts has been updated on GitHub, while preserving your local customizations.

**Use Case:**
- You've already generated `.github/copilot-instructions.md`
- You've added custom rules or modified content
- You have analysis files in `.results/`
- New version of new-project-ai-prompts is available on GitHub
- You want to merge updates WITHOUT losing your customizations

---

## üöÄ First-Time Update? Enable Auto-Detection First!

**If your project was generated BEFORE version 0.2.0** (before January 24, 2026), your instructions don't have the automatic update detection mechanism.

### Quick Setup Prompt (Copy & Paste to AI Agent):

```
I'm using AI Prompt Chain Generator and want to enable automatic update detection for future versions.

Please help me:

1. Read the latest version management section:
   https://github.com/ale4ko69/new-project-ai-prompts/blob/main/templates/base/universal-rules.md
   (Find section: "üîÑ Version Management & Updates")

2. Add this entire section to my .github/copilot-instructions.md
   - Insert it before the final "Template Version:" line
   - Keep all existing content

3. Create version tracking file: .ai-prompt-chain-generator.json
   Structure:
   {
     "version": "0.1.0",
     "generator": "AI Prompt Chain Generator",
     "repository": "https://github.com/ale4ko69/new-project-ai-prompts",
     "generatedAt": "{current_generation_date}",
     "projectMode": "single",
     "customModifications": true,
     "notes": "Upgraded from pre-0.2.0 version. Added auto-update detection."
   }

4. After setup, check for available updates from GitHub

Once complete, you'll have automatic update notifications!
```

**What this does:**
- ‚úÖ Adds version checking rules to your instructions
- ‚úÖ Creates version tracking file
- ‚úÖ Enables daily update checks
- ‚úÖ Marks your project as having customizations (safe mode)
- ‚úÖ Prepares for future seamless updates

**After running this prompt once, proceed with the update process below.**

---

## ‚ö†Ô∏è CRITICAL: Safety First

This process will:
- ‚úÖ Detect your current version
- ‚úÖ Fetch latest changes from GitHub
- ‚úÖ Create backups before any changes
- ‚úÖ Preserve your custom content
- ‚úÖ Show you what will change BEFORE applying
- ‚úÖ Let YOU decide what to merge

---

## Parameters

```
{project_folder} = ["."]  # Your project root
{instructions_file} = .github/copilot-instructions.md
{results_folder} = .results
{backup_folder} = .results/backups
{github_repo} = https://github.com/ale4ko69/new-project-ai-prompts
```

---

## Process

### Step 1: Detect Current State

**Scan local project:**

**Windows (PowerShell):**
```powershell
# Check what exists
Get-ChildItem -Path ".results/"
Test-Path ".github/copilot-instructions.md"

# Look for version marker
Select-String -Path ".github/copilot-instructions.md" -Pattern "Generated by:"
Select-String -Path ".github/copilot-instructions.md" -Pattern "Version:"
```

**Unix/Linux/macOS (Bash):**
```bash
# Check what exists
ls .results/
ls .github/copilot-instructions.md

# Look for version marker
grep "Generated by:" .github/copilot-instructions.md
grep "Version:" .github/copilot-instructions.md
```

**Extract information:**
- What steps were run? (check .results/ files)
- When was it generated? (check dates)
- What version of prompts was used?
- What custom content exists?

**Output:**
```markdown
## Current State

Project: {project_name}
Last generated: 2026-01-20
Generated with: new-project-ai-prompts v0.1.0 (6 steps: 0-5)

Files found:
- .results/0-detect-setup.md ‚úÖ
- .results/1-techstack.md ‚úÖ
- .results/2-categorize-files.md ‚úÖ
- .results/3-identify-architecture.md ‚úÖ
- .results/4-domain-deep-dive.md ‚úÖ
- .results/5-styleguide-generation.md ‚úÖ
- .github/copilot-instructions.md ‚úÖ (CUSTOMIZED)

Customizations detected:
- Section "Team-Specific Rules" (lines 450-480)
- Section "Internal APIs" (lines 520-550)
- Modified "Testing Guidelines" (lines 300-320)
```

---

### Step 2: Fetch Latest from GitHub

**Get current version info:**

**Windows (PowerShell):**
```powershell
# Fetch latest README
Invoke-WebRequest -Uri "https://raw.githubusercontent.com/ale4ko69/new-project-ai-prompts/main/README.md" -OutFile "temp-readme.md"

# Extract version
Select-String -Path "temp-readme.md" -Pattern "Version:"
```

**Unix/Linux/macOS (Bash):**
```bash
# Fetch latest README
curl https://raw.githubusercontent.com/ale4ko69/new-project-ai-prompts/main/README.md

# Extract version
grep "Version:" README.md
```

**Compare versions:**
```markdown
Your version: 0.1.0 (6 steps)
Latest version: 0.2.0 (8 steps)

Changes:
- Added Step 6: dependency-audit.md (NEW)
- Renamed Step 6 ‚Üí Step 7 (build-instructions.md)
- Updated templates/base/universal-rules.md
- Updated README structure
```

---

### Step 3: Create Safety Backups

**Before ANY changes:**

**Windows (PowerShell):**
```powershell
# Create backup folder with timestamp
$timestamp = Get-Date -Format "yyyyMMdd_HHmmss"
New-Item -ItemType Directory -Path ".results/backups/$timestamp" -Force

# Backup ALL current files
Copy-Item -Path ".results/*.md" -Destination ".results/backups/$timestamp/" -Recurse
Copy-Item -Path ".github/copilot-instructions.md" -Destination ".results/backups/$timestamp/"

Write-Host "‚úÖ Backups created in .results/backups/$timestamp"
```

**Unix/Linux/macOS (Bash):**
```bash
# Create backup folder with timestamp
timestamp=$(date +%Y%m%d_%H%M%S)
mkdir -p .results/backups/$timestamp

# Backup ALL current files
cp -r .results/*.md .results/backups/$timestamp/
cp .github/copilot-instructions.md .results/backups/$timestamp/

echo "‚úÖ Backups created in .results/backups/$timestamp"
```

**Verify backups:**

**Windows:**
```powershell
Get-ChildItem -Path ".results/backups/$timestamp" -Recurse
```

**Unix/Linux/macOS:**
```bash
ls -la .results/backups/$timestamp/
```

---

### Step 4: Analyze Custom Content

**Identify custom sections in copilot-instructions.md:**

Look for:
- Sections NOT from templates
- Modified template sections
- Added content

**Mark custom content:**
```markdown
## Analysis of Custom Content

### Custom Sections (keep as-is):
- Lines 450-480: "Team-Specific Rules"
  ‚Üí Not from any template, USER ADDED
  ‚Üí PRESERVE

- Lines 520-550: "Internal APIs"
  ‚Üí Not from any template, USER ADDED
  ‚Üí PRESERVE

### Modified Template Sections (merge carefully):
- Lines 300-320: "Testing Guidelines"
  ‚Üí Original template modified by user
  ‚Üí MERGE: Keep user changes + add new template content

### Template Sections (safe to replace):
- Lines 50-200: "Universal Rules"
  ‚Üí From templates/base/universal-rules.md
  ‚Üí REPLACE with latest version
```

---

### Step 5: Plan Migration

**Show migration plan to USER:**

```markdown
## üîÑ MIGRATION PLAN

### Step 5.1: File Operations

**Rename files:**
- .results/6-build-instructions.md ‚Üí .results/7-build-instructions.md

**Create new files:**
- .results/6-dependency-audit.md (NEW - needs to run Step 6)

**Update files:**
- .results/7-build-instructions.md (update to reference Step 6)

### Step 5.2: Content Updates

**Template sections to UPDATE:**
1. Universal Rules (lines 50-200)
   - Old: 500 lines
   - New: 545 lines
   - Changes: Added Dependency Maintenance section

2. Language Patterns (lines 250-280)
   - Old: nodejs-patterns v1
   - New: nodejs-patterns v2
   - Changes: Added async/await best practices

**Custom sections to PRESERVE:**
1. Team-Specific Rules (lines 450-480) ‚Üê YOUR CONTENT
2. Internal APIs (lines 520-550) ‚Üê YOUR CONTENT

**Modified sections to MERGE:**
1. Testing Guidelines (lines 300-320)
   - Your changes: Added integration test examples
   - Template updates: Added E2E test patterns
   - Result: Combine both

### Step 5.3: New Analysis Steps

**Run new steps:**
- Step 6: dependency-audit.md (NEW)
  - Scan dependencies
  - Check security
  - Generate report

### Step 5.4: Rebuild Instructions

**Regenerate .github/copilot-instructions.md:**
- Use updated templates
- Insert Step 6 results
- Preserve custom sections
- Merge modified sections

---

‚ö†Ô∏è **REVIEW THIS PLAN CAREFULLY**

Questions:
1. Proceed with this migration? [y/n]
2. Run Step 6 (dependency audit)? [y/n]
3. Review each merge conflict manually? [y/n/auto]
```

**WAIT FOR USER APPROVAL**

---

### Step 6: Execute Migration

**If user approves:**

#### 6.1: Rename Files

**Windows (PowerShell):**
```powershell
# Rename existing files
if (Test-Path ".results/6-build-instructions.md") {
  Move-Item -Path ".results/6-build-instructions.md" -Destination ".results/7-build-instructions.md"
  Write-Host "‚úÖ Renamed 6-build-instructions.md ‚Üí 7-build-instructions.md"
}
```

**Unix/Linux/macOS (Bash):**
```bash
# Rename existing files
if [ -f ".results/6-build-instructions.md" ]; then
  mv .results/6-build-instructions.md .results/7-build-instructions.md
  echo "‚úÖ Renamed 6-build-instructions.md ‚Üí 7-build-instructions.md"
fi
```

#### 6.2: Run New Steps

```bash
# Run Step 6 (dependency audit)
echo "Running Step 6: Dependency Audit..."

# Execute Step 6 logic from GitHub
# (Read 6-dependency-audit.md from GitHub and execute)
```

#### 6.3: Extract Custom Content

**Windows (PowerShell):**
```powershell
# Extract custom sections from old instructions
Get-Content ".github/copilot-instructions.md" | Select-Object -Skip 449 -First 31 | Out-File ".results/temp/custom-team-rules.md"
Get-Content ".github/copilot-instructions.md" | Select-Object -Skip 519 -First 31 | Out-File ".results/temp/custom-internal-apis.md"
```

**Unix/Linux/macOS (Bash):**
```bash
# Extract custom sections from old instructions
sed -n '450,480p' .github/copilot-instructions.md > .results/temp/custom-team-rules.md
sed -n '520,550p' .github/copilot-instructions.md > .results/temp/custom-internal-apis.md
```

#### 6.4: Build New Instructions

**Combine:**
1. New template content (from GitHub)
2. New Step 6 results
3. Preserved custom sections
4. Merged modified sections

**Structure:**
```markdown
# {Project} - AI Coding Instructions

[Header - from template]

## Project Overview
[From Steps 1-4 - keep existing]

## Universal Rules
[From template - UPDATED version]

## Language Patterns
[From template - UPDATED version]

## Testing Guidelines
[MERGED: template updates + user changes]

## Team-Specific Rules
[CUSTOM CONTENT - preserved from lines 450-480]

## Internal APIs
[CUSTOM CONTENT - preserved from lines 520-550]

## Dependency Maintenance
[NEW SECTION - from Step 6]

[Rest of template content]
```

#### 6.5: Write Updated File

**Windows (PowerShell):**
```powershell
# Write new instructions
Move-Item -Path ".github/copilot-instructions.md" -Destination ".results/backups/$timestamp/copilot-instructions.md.before-update"
Copy-Item -Path ".results/temp/new-instructions.md" -Destination ".github/copilot-instructions.md"

Write-Host "‚úÖ Updated .github/copilot-instructions.md"
Write-Host "üì¶ Backup: .results/backups/$timestamp/copilot-instructions.md.before-update"
```

**Unix/Linux/macOS (Bash):**
```bash
# Write new instructions
mv .github/copilot-instructions.md .results/backups/$timestamp/copilot-instructions.md.before-update
cp .results/temp/new-instructions.md .github/copilot-instructions.md

echo "‚úÖ Updated .github/copilot-instructions.md"
echo "üì¶ Backup: .results/backups/$timestamp/copilot-instructions.md.before-update"
```

---

### Step 7: Verify Migration

**Run checks:**

**Windows (PowerShell):**
```powershell
# Check file structure
Get-ChildItem -Path ".results/" -Filter "*.md"

# Expected files:
# - .results/0-detect-setup.md ‚úÖ
# - .results/1-techstack.md ‚úÖ
# - .results/2-categorize-files.md ‚úÖ
# - .results/3-identify-architecture.md ‚úÖ
# - .results/4-domain-deep-dive.md ‚úÖ
# - .results/5-styleguide-generation.md ‚úÖ
# - .results/6-dependency-audit.md ‚úÖ (NEW)
# - .results/7-build-instructions.md ‚úÖ (renamed from 6)

# Verify custom content preserved
Select-String -Path ".github/copilot-instructions.md" -Pattern "Team-Specific Rules" -Context 0,30
Select-String -Path ".github/copilot-instructions.md" -Pattern "Internal APIs" -Context 0,30

# Verify new content added
Select-String -Path ".github/copilot-instructions.md" -Pattern "Dependency Maintenance" -Context 0,10
```

**Unix/Linux/macOS (Bash):**
```bash
# Check file structure
ls -la .results/

Expected:
- .results/0-detect-setup.md ‚úÖ
- .results/1-techstack.md ‚úÖ
- .results/2-categorize-files.md ‚úÖ
- .results/3-identify-architecture.md ‚úÖ
- .results/4-domain-deep-dive.md ‚úÖ
- .results/5-styleguide-generation.md ‚úÖ
- .results/6-dependency-audit.md ‚úÖ (NEW)
- .results/7-build-instructions.md ‚úÖ (renamed from 6)

# Verify custom content preserved
grep -A 30 "Team-Specific Rules" .github/copilot-instructions.md
grep -A 30 "Internal APIs" .github/copilot-instructions.md

# Verify new content added
grep -A 10 "Dependency Maintenance" .github/copilot-instructions.md
```

**Show diff:**

**Windows (PowerShell):**
```powershell
# Show what changed
Compare-Object (Get-Content ".results/backups/$timestamp/copilot-instructions.md.before-update") (Get-Content ".github/copilot-instructions.md")
```

**Unix/Linux/macOS (Bash):**
```bash
# Show what changed
diff .results/backups/$timestamp/copilot-instructions.md.before-update .github/copilot-instructions.md
```

---

### Step 8: Generate Update Report

```markdown
# ‚úÖ UPDATE COMPLETE

## Summary

**Version:** 0.1.0 ‚Üí 0.2.0
**Date:** 2026-01-24
**Duration:** 2 minutes

## Changes Applied

### Files Renamed
- ‚úÖ .results/6-build-instructions.md ‚Üí .results/7-build-instructions.md

### Files Created
- ‚úÖ .results/6-dependency-audit.md (NEW - 1,234 lines)

### Template Sections Updated
- ‚úÖ Universal Rules (45 changes)
- ‚úÖ Language Patterns (12 changes)
- ‚úÖ Testing Guidelines (merged with your changes)

### Custom Content Preserved
- ‚úÖ Team-Specific Rules (lines 450-480)
- ‚úÖ Internal APIs (lines 520-550)

### New Sections Added
- ‚úÖ Dependency Maintenance (from Step 6)
- ‚úÖ Monorepo Support
- ‚úÖ Security Audit Schedule

## Dependency Audit Results

üî¥ Critical: 2 packages need immediate update
‚ö†Ô∏è Recommended: 5 packages should be updated
‚úÖ Up to date: 45 packages

[See full report: .results/6-dependency-audit.md]

## Backups Created

All previous versions backed up to:
`.results/backups/20260124_143022/`

To rollback:

**Windows (PowerShell):**
```powershell
Copy-Item -Path ".results/backups/20260124_143022/*.md" -Destination ".results/" -Force
Copy-Item -Path ".results/backups/20260124_143022/copilot-instructions.md.before-update" -Destination ".github/copilot-instructions.md" -Force
```

**Unix/Linux/macOS (Bash):**
```bash
cp .results/backups/20260124_143022/*.md .results/
cp .results/backups/20260124_143022/copilot-instructions.md.before-update .github/copilot-instructions.md
```

## Next Steps

1. ‚úÖ Review updated .github/copilot-instructions.md
2. ‚úÖ Check custom sections are preserved
3. ‚úÖ Address critical dependency issues (see Step 6 report)
4. ‚è≥ Test with AI coding assistant
5. ‚è≥ Clean up backups (optional): `rm -rf .results/backups/20260124_143022`

## Verification

Run this to verify everything works:

**Windows (PowerShell):**
```powershell
# Check all files present
Get-ChildItem -Path ".results/*.md"

# Test with AI assistant
# (paste .github/copilot-instructions.md and test)
```

**Unix/Linux/macOS (Bash):**
```bash
# Check all files present
ls .results/*.md

# Test with AI assistant
# (paste .github/copilot-instructions.md and test)
```

---

**Migration successful!** üéâ

Your customizations are preserved and new features are integrated.
```

---

## Rollback Instructions

**If something went wrong:**

**Windows (PowerShell):**
```powershell
# Get list of backups
Get-ChildItem -Path ".results/backups/" -Directory

# Choose backup to restore
$timestamp = "20260124_143022"

# Restore all files
Copy-Item -Path ".results/backups/$timestamp/*.md" -Destination ".results/" -Force
Copy-Item -Path ".results/backups/$timestamp/copilot-instructions.md.before-update" -Destination ".github/copilot-instructions.md" -Force

# Verify
git status

Write-Host "‚úÖ Rolled back to version before update"
```

**Unix/Linux/macOS (Bash):**
```bash
# Get list of backups
ls -la .results/backups/

# Choose backup to restore
timestamp="20260124_143022"

# Restore all files
cp .results/backups/$timestamp/*.md .results/
cp .results/backups/$timestamp/copilot-instructions.md.before-update .github/copilot-instructions.md

# Verify
git status

echo "‚úÖ Rolled back to version before update"
```

---

## Conflict Resolution

**If merge conflicts occur:**

```markdown
## ‚ö†Ô∏è MERGE CONFLICT

Section: "Testing Guidelines" (lines 300-320)

**YOUR VERSION:**
```markdown
## Testing Guidelines
- Always write unit tests
- Use Jest for testing
- Integration tests in /tests/integration
```

**NEW TEMPLATE:**
```markdown
## Testing Guidelines
- Write unit tests for all functions
- Use Jest/Vitest for testing
- E2E tests with Playwright
- Integration tests in /tests/integration
```

**CONFLICT:** Both modified same section

**Options:**
1. Keep YOUR version only
2. Use NEW template only
3. MERGE both (recommended):
   ```markdown
   ## Testing Guidelines
   - Always write unit tests for all functions
   - Use Jest for testing
   - E2E tests with Playwright
   - Integration tests in /tests/integration
   ```

Choose [1/2/3]:
```

---

## Best Practices

### DO:
- ‚úÖ Always create backups before updating
- ‚úÖ Review the migration plan carefully
- ‚úÖ Test after migration
- ‚úÖ Keep custom content in clearly marked sections
- ‚úÖ Document your customizations

### DON'T:
- ‚ùå Skip backups
- ‚ùå Auto-merge without review
- ‚ùå Modify template sections heavily (create custom sections instead)
- ‚ùå Delete old backups immediately

### Recommended Custom Section Markers:

```markdown
## üîß CUSTOM: Team-Specific Rules
<!-- START CUSTOM CONTENT - DO NOT REPLACE -->

[Your custom content here]

<!-- END CUSTOM CONTENT -->
```

This makes it easier for update script to preserve your content.

---

## Troubleshooting

**Problem:** "Step 6 file already exists"
**Solution:** You may have already updated. Check file dates or version.

**Problem:** "Custom content lost after update"
**Solution:** Restore from backup and mark custom sections clearly.

**Problem:** "New step failed to run"
**Solution:** Check dependencies, may need to install tools for Step 6.

---

## Version Compatibility

| Your Version | Can Update To | Migration Complexity |
|--------------|---------------|---------------------|
| 0.1.0 (6 steps) | 0.2.0 (8 steps) | Medium (file renames) |
| 0.2.0 (8 steps) | Future versions | Low (additive only) |

---

**Last Updated:** 2026-01-24
